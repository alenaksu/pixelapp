import{MimeTypes as l}from"../types.js";export*from"./events.js";export*from"./webgl.js";export function getPixel(e,r,n){const t=(r*n.width+e)*4;return[...n.data.slice(t,t+4)]}export function*iteratePixels(e){for(let r=0;r<e.width;r++)for(let n=0;n<e.height;n++){const t=(n*e.width+r)*4;yield[getPixel(r,n,e),r,n,t]}}export function toMatrix(e){const r=Array.from({length:e.height},()=>Array(e.width).fill(0));for(const[n,t,o]of iteratePixels(e))r[o][t]=n;return r}export function getPixelMatrix(e,r,n){const t=[];for(let o=-r;o<=r;o++){const i=[];for(let c=-r;c<=r;c++){const s=e+(c+o*n.width)*4,[a,h,f,u]=s in n.data?[...n.data.slice(s,s+3),255]:[0,0,0,0];i.push((a+h+f+u)/4)}t.push(i)}return t}export function luma(e){return e[0]*.2126+e[1]*.7152+e[2]*.0722}export function loadImage(e,r=2048){return new Promise(n=>{const t=new Image;t.onload=()=>{const o=Math.min(r/(t.width>t.height?t.width:t.height),1),i=getImageData(t,t.width*o,t.height*o);n(i)},t.src=e})}export function getImageData(e,r=e.width,n=e.height){const t=document.createElement("canvas");t.width=r,t.height=n;const o=t.getContext("2d");o.imageSmoothingQuality="high",o.drawImage(e,0,0,t.width,t.height);const i=o.getImageData(0,0,t.width,t.height);return i}export function rgbToHsl(e,r,n){e/=255,r/=255,n/=255;const t=Math.max(e,r,n),o=Math.min(e,r,n);let i,c;const s=(t+o)/2;if(t==o)i=c=0;else{const a=t-o;c=s>.5?a/(2-t-o):a/(t+o);switch(t){case e:i=(r-n)/a+(r<n?6:0);break;case r:i=(n-e)/a+2;break;case n:i=(e-r)/a+4;break}i/=6}return[i,c,s]}export function hslToRgb(e,r,n){let t,o,i;if(r==0)t=o=i=n;else{const c=(h,f,u)=>(u<0&&(u+=1),u>1&&(u-=1),u<1/6?h+(f-h)*6*u:u<1/2?f:u<2/3?h+(f-h)*(2/3-u)*6:h),s=n<.5?n*(1+r):n+r-n*r,a=2*n-s;t=c(a,s,e+1/3),o=c(a,s,e),i=c(a,s,e-1/3)}return[Math.round(t*255),Math.round(o*255),Math.round(i*255)]}export function openFile(e=l.Image){return new Promise((r,n)=>{const t=document.createElement("input");t.type="file",t.accept=e,t.onchange=()=>{r(t.files.item(0))},t.onblur=n,t.click()})}export function rgbToHex(e,r=!0){const n=r?255:1;return`#${e.slice(0,3).map(t=>(t*n).toString(16).padStart(2,"0")).join("")}`}export function hexToRgb(e,r=!0){const n=r?255:1;return[parseInt(e.slice(1,3),16)/n,parseInt(e.slice(3,5),16)/n,parseInt(e.slice(5,7),16)/n,n]}export function getFromPath(e,r,n){Array.isArray(r)||(r=r.split("."));for(const t of r){if(!e||!(t in e))return n;e=e[t]}return e}export default function m(e){let r,n;return(...t)=>{if(n=t,r)return;r=requestAnimationFrame(()=>{e(...n),r=null})}}export function throttle(e,r=1e3){let n;return(...t)=>{if(n)return;n=setTimeout(()=>{n=null,e(...t)},r)}}export function saveCanvas(e,{name:r="image.jpg",quality:n=80}={}){return new Promise(t=>{e.toBlob(o=>{const i=document.createElement("a");i.href=URL.createObjectURL(o),i.download="image.jpg",i.click(),setTimeout(()=>{URL.revokeObjectURL(i.href),t()})},"image/jpeg",n/100)})}

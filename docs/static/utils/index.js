import{MimeTypes as d}from"../types.js";export function getPixel(e,r,n){const t=(r*n.width+e)*4;return[...n.data.slice(t,t+4)]}export function*iteratePixels(e){for(let r=0;r<e.width;r++)for(let n=0;n<e.height;n++){const t=(n*e.width+r)*4;yield[getPixel(r,n,e),r,n,t]}}export function toMatrix(e){const r=Array.from({length:e.height},()=>Array(e.width).fill(0));for(const[n,t,i]of iteratePixels(e))r[i][t]=n;return r}export function getPixelMatrix(e,r,n){const t=[];for(let i=-r;i<=r;i++){const o=[];for(let c=-r;c<=r;c++){const s=e+(c+i*n.width)*4,[u,a,f,h]=s in n.data?[...n.data.slice(s,s+3),255]:[0,0,0,0];o.push((u+a+f+h)/4)}t.push(o)}return t}export function luma(e){return e[0]*.2126+e[1]*.7152+e[2]*.722}export function loadImage(e,r=1024){return new Promise(n=>{const t=new Image;t.onload=()=>{const i=Math.min(r/(t.width>t.height?t.width:t.height),1),o=getImageData(t,t.width*i,t.height*i);n(o)},t.src=e})}export function getImageData(e,r=e.width,n=e.height){const t=document.createElement("canvas");t.width=r,t.height=n;const i=t.getContext("2d");i.imageSmoothingQuality="high",i.drawImage(e,0,0,t.width,t.height);const o=i.getImageData(0,0,t.width,t.height);return o}export function rgbToHsl(e,r,n){e/=255,r/=255,n/=255;const t=Math.max(e,r,n),i=Math.min(e,r,n);let o,c;const s=(t+i)/2;if(t==i)o=c=0;else{const u=t-i;c=s>.5?u/(2-t-i):u/(t+i);switch(t){case e:o=(r-n)/u+(r<n?6:0);break;case r:o=(n-e)/u+2;break;case n:o=(e-r)/u+4;break}o/=6}return[o,c,s]}export function hslToRgb(e,r,n){let t,i,o;if(r==0)t=i=o=n;else{const c=(a,f,h)=>(h<0&&(h+=1),h>1&&(h-=1),h<1/6?a+(f-a)*6*h:h<1/2?f:h<2/3?a+(f-a)*(2/3-h)*6:a),s=n<.5?n*(1+r):n+r-n*r,u=2*n-s;t=c(u,s,e+1/3),i=c(u,s,e),o=c(u,s,e-1/3)}return[Math.round(t*255),Math.round(i*255),Math.round(o*255)]}export function openFile(e=d.Image){return new Promise((r,n)=>{const t=document.createElement("input");t.type="file",t.accept=e,t.onchange=()=>{r(t.files.item(0))},t.onblur=n,t.click()})}export function rgbToHex(e,r=!0){const n=r?255:1;return`#${e.slice(0,3).map(t=>(t*n).toString(16).padStart(2,"0")).join("")}`}export function hexToRgb(e,r=!0){const n=r?255:1;return[parseInt(e.slice(1,3),16)/n,parseInt(e.slice(3,5),16)/n,parseInt(e.slice(5,7),16)/n,n]}export function getFromPath(e,r,n){Array.isArray(r)||(r=r.split("."));for(const t of r){if(!e||!(t in e))return n;e=e[t]}return e}export function throttle(e,r=1e3){let n;return(...t)=>{if(n)return;n=setTimeout(()=>{n=null,e(...t)},r)}}

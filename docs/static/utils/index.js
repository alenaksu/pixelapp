import{MimeTypes as l}from"../types.js";export*from"./events.js";export*from"./webgl.js";export*from"./math.js";export*from"./template.js";export function getPixel(e,n,t){const r=(n*t.width+e)*4;return[...t.data.slice(r,r+4)]}export function*iteratePixels(e){for(let n=0;n<e.width;n++)for(let t=0;t<e.height;t++){const r=(t*e.width+n)*4;yield[getPixel(n,t,e),n,t,r]}}export function toMatrix(e){const n=Array.from({length:e.height},()=>Array(e.width).fill(0));for(const[t,r,o]of iteratePixels(e))n[o][r]=t;return n}export function getPixelMatrix(e,n,t){const r=[];for(let o=-n;o<=n;o++){const i=[];for(let u=-n;u<=n;u++){const c=e+(u+o*t.width)*4,[s,f,h,a]=c in t.data?[...t.data.slice(c,c+3),255]:[0,0,0,0];i.push((s+f+h+a)/4)}r.push(i)}return r}export function luma(e){return e[0]*.2126+e[1]*.7152+e[2]*.0722}export function loadImage(e,n=Infinity){const t=new Image;return t.src=e,t.decode().then(()=>{const r=Math.min(n/Math.max(t.width,t.height),1);return getImageData(t,t.width*r,t.height*r)})}export function getImageData(e,n=e.width,t=e.height){const r=document.createElement("canvas"),o=r.getContext("2d");return r.width=n,r.height=t,o.imageSmoothingQuality="high",o.drawImage(e,0,0,r.width,r.height),o.getImageData(0,0,r.width,r.height)}export function rgbToHsl(e,n,t){e/=255,n/=255,t/=255;const r=Math.max(e,n,t),o=Math.min(e,n,t);let i,u;const c=(r+o)/2;if(r==o)i=u=0;else{const s=r-o;switch(u=c>.5?s/(2-r-o):s/(r+o),r){case e:i=(n-t)/s+(n<t?6:0);break;case n:i=(t-e)/s+2;break;case t:i=(e-n)/s+4;break}i/=6}return[i,u,c]}export function hslToRgb(e,n,t){let r,o,i;if(n==0)r=o=i=t;else{const u=(f,h,a)=>(a<0&&(a+=1),a>1&&(a-=1),a<1/6?f+(h-f)*6*a:a<1/2?h:a<2/3?f+(h-f)*(2/3-a)*6:f),c=t<.5?t*(1+n):t+n-t*n,s=2*t-c;r=u(s,c,e+1/3),o=u(s,c,e),i=u(s,c,e-1/3)}return[Math.round(r*255),Math.round(o*255),Math.round(i*255)]}export function openFile(e=l.Image){return new Promise((n,t)=>{const r=document.createElement("input");r.type="file",r.accept=e,r.onchange=()=>{n(r.files.item(0))},r.onblur=t,r.click()})}export function rgbToHex(e,n=!0){const t=n?255:1;return`#${e.slice(0,3).map(r=>(r*t).toString(16).padStart(2,"0")).join("")}`}export function hexToRgb(e,n=!0){const t=n?255:1;return[parseInt(e.slice(1,3),16)/t,parseInt(e.slice(3,5),16)/t,parseInt(e.slice(5,7),16)/t,t]}export function getFromPath(e,n,t){Array.isArray(n)||(n=n.split("."));for(const r of n){if(!e||!(r in e))return t;e=e[r]}return e}export function rafThrottle(e){let n,t;return(...r)=>{t=r,!n&&(n=requestAnimationFrame(()=>{n=null,e(...t)}))}}export function throttle(e,n=1e3){let t;return(...r)=>{t||(t=setTimeout(()=>{t=null,e(...r)},n))}}export function debounce(e,n=500){let t;return(...r)=>{t&&clearTimeout(t),t=setTimeout(()=>{t=null,e(...r)},n)}}export function saveImage(e,{name:n="image.jpg",quality:t=80}={}){return new Promise(r=>{e.toBlob(o=>{const i=document.createElement("a");i.href=URL.createObjectURL(o),i.download="image.jpg",i.click(),setTimeout(()=>{URL.revokeObjectURL(i.href),r()})},"image/jpeg",t/100)})}
